(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{6849:function(e,t,r){Promise.resolve().then(r.bind(r,2113))},2113:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return T}});var n=r(1674);r(6655);var i=r(2498),s=r(8623),o=r(9748),c=r(7575),a=r(821),l=r(5147),d=r(150),h=r(8349),u=r(8258),x=r(9107),j=r(5540),g=r(6267),f=r(2162),Z=r(7948),m=r(5402),p=r(647),v=r(9617),y=r(4958),k=r(9651),w=r(4119),b=r(5798),I=r(9081),S=r(8314);function T(){let{entries:e,isLoading:t,isError:r,mutate:T}=(0,I.cs)(),_=async e=>{try{await S.h.put("/timeclock/entries/".concat(e,"/approve")),T()}catch(e){console.error("Approval failed",e)}},P=async e=>{try{await S.h.put("/timeclock/entries/".concat(e,"/reject"),{notes:"Rejected by manager"}),T()}catch(e){console.error("Rejection failed",e)}};return(0,n.jsxs)(i.Z,{children:[(0,n.jsxs)(s.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:4},children:[(0,n.jsxs)(i.Z,{children:[(0,n.jsx)(o.Z,{variant:"h4",sx:{fontWeight:800},children:"Time Tracking"}),(0,n.jsx)(o.Z,{color:"text.secondary",children:"Review, flag, and approve work hours with GPS verification."})]}),(0,n.jsxs)(s.Z,{direction:"row",spacing:2,children:[(0,n.jsx)(c.Z,{variant:"outlined",startIcon:(0,n.jsx)(w.Z,{}),sx:{borderRadius:2},children:"History"}),(0,n.jsx)(c.Z,{variant:"contained",color:"success",startIcon:(0,n.jsx)(v.Z,{}),sx:{borderRadius:2},children:"Approve All"})]})]}),r&&(0,n.jsx)(a.Z,{severity:"error",sx:{mb:3},children:"Failed to load time entries."}),(0,n.jsx)(l.Z,{sx:{p:0,borderRadius:4,overflow:"hidden",border:"1px solid",borderColor:"divider"},children:(0,n.jsx)(d.Z,{children:(0,n.jsxs)(h.Z,{children:[(0,n.jsx)(u.Z,{sx:{bgcolor:"rgba(0,0,0,0.01)"},children:(0,n.jsxs)(x.Z,{children:[(0,n.jsx)(j.Z,{sx:{fontWeight:700},children:"Worker"}),(0,n.jsx)(j.Z,{sx:{fontWeight:700},children:"Location / Date"}),(0,n.jsx)(j.Z,{sx:{fontWeight:700},children:"Clock In/Out"}),(0,n.jsx)(j.Z,{sx:{fontWeight:700},children:"Total Time"}),(0,n.jsx)(j.Z,{sx:{fontWeight:700},children:"Verification"}),(0,n.jsx)(j.Z,{sx:{fontWeight:700},children:"Status"}),(0,n.jsx)(j.Z,{align:"right",children:"Actions"})]})}),(0,n.jsx)(g.Z,{children:t?(0,n.jsx)(x.Z,{children:(0,n.jsx)(j.Z,{colSpan:7,align:"center",sx:{py:10},children:(0,n.jsx)(f.Z,{size:24})})}):0===e.length?(0,n.jsx)(x.Z,{children:(0,n.jsx)(j.Z,{colSpan:7,align:"center",sx:{py:10},children:(0,n.jsx)(o.Z,{color:"text.secondary",children:"No time entries found."})})}):e.map(e=>{var t,r;let i=e.workerId,c=e.locationId;return(0,n.jsxs)(x.Z,{hover:!0,children:[(0,n.jsxs)(j.Z,{children:[(0,n.jsxs)(o.Z,{variant:"body2",sx:{fontWeight:700},children:[null===(t=i.name)||void 0===t?void 0:t.first," ",null===(r=i.name)||void 0===r?void 0:r.last]}),(0,n.jsxs)(o.Z,{variant:"caption",color:"text.secondary",children:["ID: ",e._id.slice(-6)]})]}),(0,n.jsxs)(j.Z,{children:[(0,n.jsx)(o.Z,{variant:"body2",sx:{fontWeight:600},children:(null==c?void 0:c.name)||"Unknown"}),(0,n.jsx)(o.Z,{variant:"caption",color:"text.secondary",children:new Date(e.clockIn.time).toLocaleDateString()})]}),(0,n.jsx)(j.Z,{children:(0,n.jsxs)(s.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,n.jsx)(o.Z,{variant:"body2",sx:{fontWeight:500},children:new Date(e.clockIn.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,n.jsx)(o.Z,{variant:"caption",sx:{opacity:.5},children:"â†’"}),(0,n.jsx)(o.Z,{variant:"body2",sx:{fontWeight:500},children:e.clockOut?new Date(e.clockOut.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"})]})}),(0,n.jsx)(j.Z,{children:(0,n.jsx)(o.Z,{variant:"body2",sx:{fontWeight:700},children:e.totalMinutes?"".concat(Math.floor(e.totalMinutes/60),"h ").concat(e.totalMinutes%60,"m"):"--"})}),(0,n.jsx)(j.Z,{children:(0,n.jsxs)(s.Z,{direction:"row",spacing:1,children:[(0,n.jsx)(Z.Z,{title:e.clockIn.withinFence?"Verified within Geofence":"Outside Geofence",children:(0,n.jsx)(k.Z,{fontSize:"small",sx:{color:e.clockIn.withinFence?"success.main":"error.main"}})}),e.flaggedForReview&&(0,n.jsx)(Z.Z,{title:"Manually flagged or accuracy low",children:(0,n.jsx)(b.Z,{fontSize:"small",sx:{color:"warning.main"}})})]})}),(0,n.jsx)(j.Z,{children:(0,n.jsx)(m.Z,{label:e.status.replace("_"," "),size:"small",sx:{fontWeight:700,textTransform:"capitalize",bgcolor:"approved"===e.status?"success.light":"rejected"===e.status?"error.light":"warning.light",color:"approved"===e.status?"success.main":"rejected"===e.status?"error.main":"warning.main"}})}),(0,n.jsx)(j.Z,{align:"right",children:(0,n.jsx)(s.Z,{direction:"row",spacing:1,justifyContent:"flex-end",children:("clocked_out"===e.status||"clocked_in"===e.status)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.Z,{size:"small",color:"success",onClick:()=>_(e._id),children:(0,n.jsx)(v.Z,{fontSize:"small"})}),(0,n.jsx)(p.Z,{size:"small",color:"error",onClick:()=>P(e._id),children:(0,n.jsx)(y.Z,{fontSize:"small"})})]})})})]},e._id)})})]})})})]})}},8314:function(e,t,r){"use strict";r.d(t,{h:function(){return s}});var n=r(925);let i=r(5504).env.NEXT_PUBLIC_API_URL||"http://localhost:3000/api/v1",s=n.Z.create({baseURL:i,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{{let t=localStorage.getItem("accessToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!r._retry){r._retry=!0;try{let e=localStorage.getItem("refreshToken");if(!e)throw Error("No refresh token");let{data:t}=await n.Z.post("".concat(i,"/auth/refresh"),{refreshToken:e});return localStorage.setItem("accessToken",t.accessToken),localStorage.setItem("refreshToken",t.refreshToken),r.headers.Authorization="Bearer ".concat(t.accessToken),s(r)}catch(e){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(e)}}return Promise.reject(e)})},9081:function(e,t,r){"use strict";r.d(t,{L8:function(){return l},cs:function(){return a},dE:function(){return c},iy:function(){return o}});var n=r(2025),i=r(8314);let s=e=>i.h.get(e).then(e=>e.data),o=()=>{let{data:e,error:t,mutate:r}=(0,n.ZP)("/users",s);return{staff:(null==e?void 0:e.users)||[],isLoading:!t&&!e,isError:t,mutate:r}},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams(e).toString(),{data:r,error:i,mutate:o}=(0,n.ZP)("/shifts?".concat(t),s);return{shifts:(null==r?void 0:r.shifts)||[],isLoading:!i&&!r,isError:i,mutate:o}},a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams(e).toString(),{data:r,error:i,mutate:o}=(0,n.ZP)("/timeclock/entries?".concat(t),s);return{entries:(null==r?void 0:r.entries)||[],isLoading:!i&&!r,isError:i,mutate:o}},l=(e,t)=>{let{data:r,error:s,mutate:o}=(0,n.ZP)(e&&t?["/payroll/calculate",e,t]:null,()=>i.h.post("/payroll/calculate",{startDate:e,endDate:t}).then(e=>e.data));return{payroll:(null==r?void 0:r.results)||[],summary:(null==r?void 0:r.summary)||{totalGrossPay:0,totalPAYE:0,totalNI:0,totalNetPay:0},isLoading:!s&&!r,isError:s,mutate:o}}}},function(e){e.O(0,[462,954,781,470,541,821,169,402,512,293,997,744],function(){return e(e.s=6849)}),_N_E=e.O()}]);